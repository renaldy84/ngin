var sys = require('sys');
var fs = require('fs');
var redis = require('../lib/redis');

var db = redis.createStreamingClient(6379, "127.0.0.1");

// write 1 MB to redis, stream from redis to disk

var buf = new Buffer(8192).slice(0, 8192);

db.query("del", "testkey");

for (var i = 0; i < buf.length; i++) {
    buf[i] = 65; // A
}

var w = 0;

for (var i = 0; i < 125; i++) {
    sys.puts('appending 8192 bytes to testkey');
    db.query("append", "testkey", buf);
}

var read = db.createReadStream("get", "testkey");
var write = fs.createWriteStream("key", { flags: 'w'});

read.on("data", function (data) {
    sys.puts("read stream: got data event");
    sys.puts("read stream: data length: " + data.length);
})
read.on("end", function () {
    sys.puts("read stream: got end event");
});

sys.pump(read, write);
