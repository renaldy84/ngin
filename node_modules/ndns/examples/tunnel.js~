var ndns = require('../lib/ndns');
var server = ndns.createServer('udp4');

var BIND_PORT = 53;

var ns_c = ndns.ns_class;
var ns_t = ndns.ns_type;

server.on("request", function(req, res) {
    res.setHeader(req.header);

    for (var i = 0; i < req.q.length; i++)
	res.q.add(req.q[i]);

    if (req.q.length > 0) {
	var name = req.q[0].name;
	if (name == ".")
	    name = "";
	res.header.qr = 1;
	res.header.ra = 1;
	res.header.rd = 0;
	res.header.ancount = 3;
	res.header.nscount = 4;
	res.header.arcount = 5;
	res.addRR(name, 1, ns_c.in, ns_t.soa,
		  "hostmaster." + name,
		  "hostmaster." + name,
		  1, 2, 3, 4, 5);
	res.addRR(name, 2, ns_c.in, ns_t.txt, "Hello World");
	res.addRR(name, 3, ns_c.in, ns_t.ns, "mail." + name);
	res.addRR(name, 4, ns_c.in, ns_t.ns, "ns1." + name);
	res.addRR(name, 5, ns_c.in, ns_t.ns, "ns2." + name);
	res.addRR(name, 6, ns_c.in, ns_t.ns, "ns3." + name);
	res.addRR(name, 7, ns_c.in, ns_t.ns, "ns4." + name);
	res.addRR("mail." + name, 8, ns_c.in, ns_t.a, "127.0.0.1");
	res.addRR("ns1." + name, 9, ns_c.in, ns_t.a, "127.0.0.1");
	res.addRR("ns2." + name, 10, ns_c.in, ns_t.a, "127.0.0.2");
	res.addRR("ns3." + name, 11, ns_c.in, ns_t.a, "127.0.0.3");
	res.addRR("ns4." + name, 12, ns_c.in, ns_t.a, "127.0.0.4");
    }
    res.send();
});

server.bind(BIND_PORT);
